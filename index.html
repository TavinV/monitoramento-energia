<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoramento de Energia</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Reset e configurações gerais */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #2c5aa0;
            --secondary-color: #2ecc71;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        body {
            background-color: #f5f7fa;
            color: var(--dark-color);
            line-height: 1.6;
        }

        /* Layout principal */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Cabeçalho */
        header {
            background-color: white;
            box-shadow: var(--card-shadow);
            padding: 1.5rem 0;
            margin-bottom: 2rem;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            color: var(--primary-color);
            font-size: 1.8rem;
        }

        .logo h1 {
            color: var(--primary-color);
            font-weight: 600;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #2ecc71;
        }

        /* Seção de métricas */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 2rem;
        }

        .metric-card {
            background-color: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            display: flex;
            flex-direction: column;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .metric-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .metric-icon svg {
            width: 20px;
            height: 20px;
        }

        .metric-icon.voltage {
            background-color: var(--primary-color);
        }

        .metric-icon.current {
            background-color: #3498db;
        }

        .metric-icon.power {
            background-color: #9b59b6;
        }

        .metric-icon.energy {
            background-color: var(--secondary-color);
        }

        .metric-icon.cost {
            background-color: #e74c3c;
        }

        .metric-title {
            font-size: 0.9rem;
            color: #6c757d;
            text-transform: uppercase;
            font-weight: 500;
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .metric-unit {
            font-size: 0.9rem;
            color: #6c757d;
        }

        /* Seção do gráfico */
        .chart-section {
            background-color: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 2rem;
        }

        .section-title {
            margin-bottom: 1rem;
            color: var(--primary-color);
            font-weight: 600;
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        /* Rodapé */
        footer {
            background-color: white;
            padding: 1rem 0;
            text-align: center;
            color: #6c757d;
            font-size: 0.9rem;
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.05);
        }

        .last-update {
            margin-top: 0.5rem;
            font-weight: 500;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .header-content {
                flex-direction: column;
                gap: 10px;
            }

            .logo {
                justify-content: center;
            }

            .metric-value {
                font-size: 1.5rem;
            }
        }
    </style>
</head>

<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">⚡</div>
                    <h1>Monitoramento de Energia</h1>
                </div>
                <div class="status-indicator" id="statusIndicator">
                    <span class="status-dot"></span>
                    <span>Conectado</span>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <section class="metrics-grid">
            <div class="metric-card">
                <div class="metric-header">
                    <h3 class="metric-title">Tensão</h3>
                    <div class="metric-icon voltage">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" />
                        </svg>
                    </div>
                </div>
                <div class="metric-value" id="voltageValue">127.00</div>
                <div class="metric-unit">Volts (V)</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <h3 class="metric-title">Corrente</h3>
                    <div class="metric-icon current">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path
                                d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" />
                            <polyline points="7.5 4.21 12 6.81 16.5 4.21" />
                            <polyline points="7.5 19.79 7.5 14.6 3 12" />
                            <polyline points="21 12 16.5 14.6 16.5 19.79" />
                            <polyline points="3.27 6.96 12 12.01 20.73 6.96" />
                            <line x1="12" y1="22.08" x2="12" y2="12" />
                        </svg>
                    </div>
                </div>
                <div class="metric-value" id="currentValue">0.400</div>
                <div class="metric-unit">Amperes (A)</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <h3 class="metric-title">Potência</h3>
                    <div class="metric-icon power">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18.36 6.64a9 9 0 1 1-12.73 0" />
                            <line x1="12" y1="2" x2="12" y2="12" />
                        </svg>
                    </div>
                </div>
                <div class="metric-value" id="powerValue">50.800</div>
                <div class="metric-unit">Watts (W)</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <h3 class="metric-title">Energia</h3>
                    <div class="metric-icon energy">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="7" width="20" height="14" rx="2" ry="2" />
                            <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" />
                        </svg>
                    </div>
                </div>
                <div class="metric-value" id="energyValue">0.016</div>
                <div class="metric-unit">Quilowatt-hora (kWh)</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <h3 class="metric-title">Custo</h3>
                    <div class="metric-icon cost">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="1" x2="12" y2="23" />
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
                        </svg>
                    </div>
                </div>
                <div class="metric-value" id="costValue">0.0108</div>
                <div class="metric-unit">Reais (R$)</div>
            </div>
        </section>

        <section class="chart-section">
            <h2 class="section-title">Histórico de Potência (últimas 24h)</h2>
            <div class="chart-container">
                <canvas id="powerChart"></canvas>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>Sistema de Monitoramento de Energia Elétrica com ESP32</p>
            <p class="last-update" id="lastUpdate">Última atualização: 31/10/2025 00:58</p>
        </div>
    </footer>

    <script>
        // Dados iniciais simulados
        let currentData = {
            voltage: 127.0,
            current: 0.4,
            power: 50.8,
            energy: 0.016,
            cost: 0.0108,
            timestamp: new Date('2025-10-31T00:58:09.798Z')
        };

        // Elementos DOM
        const voltageValue = document.getElementById('voltageValue');
        const currentValue = document.getElementById('currentValue');
        const powerValue = document.getElementById('powerValue');
        const energyValue = document.getElementById('energyValue');
        const costValue = document.getElementById('costValue');
        const lastUpdate = document.getElementById('lastUpdate');
        const statusIndicator = document.getElementById('statusIndicator');

        // Configuração do gráfico
        let powerChart;
        const chartLabels = [];
        const chartData = [];

        // Inicializa o gráfico com dados simulados
        function initializeChart() {
            const ctx = document.getElementById('powerChart').getContext('2d');

            // Gerar dados iniciais para as últimas 24 horas
            const now = new Date();
            for (let i = 23; i >= 0; i--) {
                const time = new Date(now);
                time.setHours(now.getHours() - i);
                chartLabels.push(time.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }));

                // Simular variação de potência
                const basePower = 45 + Math.random() * 15;
                chartData.push(basePower);
            }

            powerChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        label: 'Potência (W)',
                        data: chartData,
                        borderColor: '#2c5aa0',
                        backgroundColor: 'rgba(44, 90, 160, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Potência (W)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Horário'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Atualiza os dados na interface
        function updateDisplay() {
            voltageValue.textContent = currentData.voltage.toFixed(2);
            currentValue.textContent = currentData.current.toFixed(3);
            powerValue.textContent = currentData.power.toFixed(3);
            energyValue.textContent = currentData.energy.toFixed(3);
            costValue.textContent = currentData.cost.toFixed(4);

            const formattedDate = currentData.timestamp.toLocaleString('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });

            lastUpdate.textContent = `Última atualização: ${formattedDate}`;
        }

        // Simula a chegada de novos dados do ESP32
        function simulateNewData() {
            // Simula pequenas variações nos dados
            currentData.voltage = 127 + (Math.random() - 0.5) * 2;
            currentData.current = 0.4 + (Math.random() - 0.5) * 0.1;
            currentData.power = currentData.voltage * currentData.current;
            currentData.energy += (currentData.power / 1000) * (5 / 3600); // kWh acumulado
            currentData.cost = currentData.energy * 0.75; // Simula custo de R$ 0,75 por kWh
            currentData.timestamp = new Date();

            // Atualiza o gráfico
            chartLabels.shift(); // Remove o primeiro elemento
            chartLabels.push(currentData.timestamp.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }));

            chartData.shift(); // Remove o primeiro elemento
            chartData.push(currentData.power);

            powerChart.update();

            // Atualiza a exibição
            updateDisplay();

            // Simula um status de conexão que pode variar
            const isConnected = Math.random() > 0.1; // 90% de chance de estar conectado
            if (isConnected) {
                statusIndicator.innerHTML = '<span class="status-dot" style="background-color: #2ecc71;"></span><span>Conectado</span>';
            } else {
                statusIndicator.innerHTML = '<span class="status-dot" style="background-color: #e74c3c;"></span><span>Desconectado</span>';
            }
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', function () {
            initializeChart();
            updateDisplay();

            // Atualiza os dados a cada 5 segundos
            setInterval(simulateNewData, 5000);
        });
    </script>
</body>

</html>